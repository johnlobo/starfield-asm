ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 1.
Hexadecimal [16-Bits]



                              1 .include "physics.h.s"
                              1 .globl sys_physics_update
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 2.
Hexadecimal [16-Bits]



                              2 .include "man/entities.h.s"
                              1 .globl man_entity_init
                              2 .globl man_entity_create
                              3 .globl man_entity_set4destruction
                              4 .globl man_entity_forall
                              5 .globl man_entity_update
                              6 
                     000A     7 max_entities = 10
                              8 
                     0000     9 e_type_default = 0x00
                     0080    10 e_type_dead = 0x80
                     0001    11 e_type_star = 0x01
                             12 
                     0001    13 e_color_default = 0x01
                             14 
                     0000    15 e_type = 0 
                     0001    16 e_x = 1
                     0002    17 e_y = 2
                     0003    18 e_vx = 3
                     0004    19 e_vy = 4
                     0005    20 e_color = 5
                     0006    21 e_prevptr = 6
                             22 
                     0008    23 sizeof_e = 8
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180 / ZX-Next / eZ80), page 3.
Hexadecimal [16-Bits]



                              3 
                              4 ;;
                              5 ;; UPDATE
                              6 ;;  Moves every physics particle
                              7 ;; Input:
                              8 ;;  IX: Particle (entity) to move
   0000                       9 sys_physics_update::
                             10     ;; Move and check
                             11     ;; X is valid unless adition generates carry: below
   0000 DD 7E 01      [19]   12     ld a, e_x(ix)
   0003 47            [ 4]   13     ld b, a
   0004 DD 86 03      [19]   14     add e_vx(ix)
   0007 DD 77 01      [19]   15     ld e_x(ix), a
   000A 90            [ 4]   16     sub b
   000B D8            [11]   17     ret c   ;; Carry = XPrev > XNew = Valid X
   000C                      18 _invalid_x:
   000C C3 00 00      [10]   19     jp man_entity_set4destruction
                             20     ;; ret
